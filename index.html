<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://unpkg.com/dayjs@1.10.7/dayjs.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.7/plugin/duration.js"></script>
    <script src="https://unpkg.com/dayjs@1.10.7/plugin/toArray.js"></script>
    <script>dayjs.extend(window.dayjs_plugin_duration)</script>
    <script>dayjs.extend(window.dayjs_plugin_toArray)</script>
    <style>
        @font-face {
            font-family: 'Myriad Pro Regular';
            font-style: normal;
            font-weight: normal;
            src: local('Myriad Pro Regular'), url('res/MYRIADPRO-REGULAR.woff') format('woff');
        }
        @font-face {
            font-family: 'Myriad Pro Light';
            font-style: normal;
            font-weight: normal;
            src: local('Myriad Pro Light'), url('res/MYRIADPRO-LIGHT.woff') format('woff');
        }
        h1 {
            font-family:'Myriad Pro Regular';
            letter-spacing: .22rem;
            font-weight:normal;
        }
        #my_life {
            display: block;
        }
        .decade {
            margin-bottom: 0.29vw;
        }
        .year {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .month {
            display: flex;
            margin:0 0.18vw;
        }
        .week {
            width: 1vw;
            height: 1vw;
            background-color: #999999;
            border-radius: 50%;
            margin: 0.06vw;
        }
        .week-done {
            background-color: #000000;
        }
        .week_number, .year_number {
            display: flex;
            width: 1vw;
            height: 1vw;
            font-size: 0.75vw;
            margin: 0.06vw;
            font-family:'Myriad Pro Light';
            font-weight:normal;
            color: #999999;
            justify-content: center;
            align-items: center;
        }
        .week_bold, .year_bold {
            font-weight:1000;
            color: #000000;
        }
        .date_area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            margin: 20px;
            z-index: 20;
            justify-content: center;
            align-items: center;
        }
        .date_button {
            display: inline-block;
            padding: 10px 25px;
            margin: 0;
            width: auto;
            min-width: 260px;
            line-height: 1.42;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            white-space: normal;
            cursor: pointer;
            border: 2px solid #999999;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            color: #fff;
            background: #ffffff;
            transition: background .15s ease;
            border-radius: 35px;
        }
        .birthday {
            --background: #fff;
            --border: #e6e7ee;
            --border-width: 0px;
            --border-focus: #0077ff;
            --border-focus-width: 0px;
            --text: #00104b;
            --text-placeholder: #999fb7;
            --default: #0077ff;
            --smoke: var(--text-placeholder);
            --error: #ff5252;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            background: var(--background);
            box-shadow: inset 0 0 0 var(--border-width) var(--border);
            transition: box-shadow 0.3s;
        }
        .birthday input {
            -webkit-appearance: none;
            background: none;
            border: none;
            outline: none;
            text-align: center;
            font-family:'Myriad Pro Regular';
            font-size: 24px;
            margin: 0;
            line-height: 28px;
            padding: 5px 5px 5px 5px;
            width: var(--w, 22px);
            color: var(--text);
        }
        .birthday svg {
            margin: 0 4px 0 12px;
        }
            .birthday input {
            --w: 52px;
        }
            .birthday input:first-of-type {
            --w: 64px;
        }
            .birthday input::-moz-placeholder {
            font-size: 24px;
            color: var(--text-placeholder);
        }
            .birthday input:-ms-input-placeholder {
            font-size: 24px;
            color: var(--text-placeholder);
        }
            .birthday input::placeholder {
            font-size: 24px;
            color: var(--text-placeholder);
        }
            .birthday span {
            display: block;
            opacity: 0.4;
            font-size: 24px;
            margin: -6px 3px 0 3px;
            color: var(--text-placeholder);
        }
    </style>
</head>
<body>

<div style="text-align:center">
    <h1>MY LIFE IN WEEKS</h1>
    <div id="my_life"></div>
    <div class="date_area"><div class="date_button">
        <div class="birthday">
            <input type="text" class="year" id="yyyy" placeholder="YYYY" maxlength="4" pattern="\d*">
            <span>-</span>
            <input type="text" class="month" id="mm" placeholder="MM" maxlength="2" pattern="\d*">
            <span>-</span>
            <input type="text" class="day" id="dd" placeholder="DD" maxlength="2" pattern="\d*">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#999999" class="bi bi-bar-chart-fill" viewBox="0 0 16 16">
                <path d="M1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3zm5-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2z"/>
            </svg> 
        </div>       
    </div></div>
</div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>

    let lived = 1775;
    let ny = 0;
    for(y=0; y<86+1;y++) {
        let year = document.createElement('div');
        year.className = "year";
        let nw = 1;
        if((y) % 10 == 0) year.classList.add("decade");
        for(x=0; x<13+1;x++) {
            var month = document.createElement('div');
            month.className = "month";
            if(x==0) {
                var month = document.createElement('div');
                month.className = "year_number";
                if(y==0) month.innerHTML = " "
                else month.innerHTML = ny-1
                if((ny-1) % 5 == 0) month.classList.add("year_bold");
            }
            else {
                for(i=0; i<4; i++) {
                    var week = document.createElement('div');
                    if(y==0) {
                        week.className = "week_number"
                        week.innerHTML = nw
                        if(i==3 || (y==0 && nw == 1)) week.classList.add("week_bold");
                    }
                    else {
                        week.className = "week"
                    }
                    nw++;
                    month.appendChild(week);
                }
            }
            year.appendChild(month);
        }
        document.getElementById('my_life').appendChild(year);
        ny++
    }

    function calculate() {
        console.log(dd.value)
        if(yyyy.value < 1900 || yyyy.value > dayjs().year()) return;
        if(mm.value < 1 || mm.value > 12) return;
        if(dd.value < 1 || dd.value > 31) return;
        let bd = dayjs(yyyy.value+"-"+mm.value+"-"+dd.value, "YYYY-MM-DD")
        if(!bd.isValid()) return;
        let diff = Math.floor(dayjs.duration(dayjs().diff(bd)).asWeeks())
        console.log(diff)

        localStorage.setItem('bd_year', bd.toArray()[0]);
        localStorage.setItem('bd_month', bd.toArray()[1]+1);
        localStorage.setItem('bd_day', bd.toArray()[2]);

        var element = document.querySelector('#my_life');
        var elementChildren = element.querySelectorAll('.week');

        for (var i = 0; i < elementChildren.length; i++) {
            if(i >= diff) elementChildren[i].classList.remove("week-done");  
            else elementChildren[i].classList.add("week-done");      
        }
    }

    let by = localStorage.getItem('bd_year');
    let bm = localStorage.getItem('bd_month');
    let bd = localStorage.getItem('bd_day');
    if(by > 0 && bm > 0 && bd > 0) {
        yyyy.value = by
        mm.value = bm < 10 ? "0"+bm : bm
        dd.value = bd < 10 ? "0"+bd : bd
        calculate()
    }

    yyyy.onkeyup = function() {
        if(parseInt(this.value) > dayjs().year()) {
            this.value = this.value.slice(0, -1)
            return
        }
        if (this.value.length === parseInt(this.attributes["maxlength"].value)) {
            mm.value = ""
            mm.focus();
        }
        calculate();
    }

    yyyy.onclick = function() {
        yyyy.value = ""
        yyyy.focus();
    }

    mm.onkeyup = function() {
        if(parseInt(this.value) > 12) {
            this.value = this.value[0]
            return
        }
        if (this.value.length === parseInt(this.attributes["maxlength"].value)) {
            dd.value = ""
            dd.focus();
        }
        else
            if(this.value.length == 0) yyyy.focus();
            else calculate()
    }

    mm.onclick = function() {
        mm.value = ""
        mm.focus();
    }

    dd.onkeyup = function() {
        if(parseInt(this.value) > 31) {
            this.value = this.value[0]
            return
        }
        if(this.value.length == 0) mm.focus();
        else calculate()
    }

    dd.onclick = function() {
        dd.value = ""
        dd.focus();
    }

</script>

</body>
</html> 